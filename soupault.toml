# General settings
[settings]
soupault_version = "5.1.0"
verbose = true

site_dir = "site"
build_dir = "build"
page_file_extensions = ["html", "md"]
markdown_extensions = ["md"]
ignore_extensions = ["draft"]

default_template_file = "templates/main.html"
default_content_selector = "main"
default_content_action = "append_child"

plugin_discovery = true
plugin_dirs = ["plugins"]

caching = true
cache_dir = ".cache"


# Extra options
[custom_options]
site_url = "https://conflor.es"
site_author = "Eri"
site_author_email = "eri@igalia.com"
site_title = "conflores"


# ---

# Preprocessors
[preprocessors]


# ---

# Index blog posts and more
[index]
sort_by = "date"
sort_descending = true
sort_type = "calendar"
date_formats = ["%F"]
leaf_file = ".leaf"
extract_after_widgets = ["append-date"]
dump_json = "index.json"

# Fields extracted from HTML to use as metadata
[index.fields]
title = { selector = ["#post-title", "h1"], required = true }
content = { selector = ["main"], required = true }
date = { selector = ["#post-date", "time"], required = true }
excerpt = { selector = ["#post-excerpt", "p"], strip_tags = true }
tags = { selector = "tag", select_all = true }
images = { selector = "img:not(.no-index)", extract_attribute = "src", select_all = true }
images_alt = { selector = "img:not(.no-index)", extract_attribute = "alt", select_all = true }

[index.views.blog]
index_selector = "#blog-index"
section = "blog/"
index_template = """
{% set flower = ["✿","❋","✾","❁","❀","✽","❃","❊"] | random %}
{% set state = namespace(i = 0) %}
{% for e in entries %}
  <article class="blog-index-element {% if "micro" in e.tags %}blog-index-micro{% endif %}">
    {% set state.i += 1 %}
    <header>
      <h2><a href="{{e.url}}">{{e.title}}<span>{{flower[state.i % 9]}}</span></a></h2>
    </header>
    <div class="row">
      <strong>{{e.date}}</strong>
      {% for tag in e.tags|sort %}<tag>{{tag}}</tag>{% endfor %}
    </div>
    {% if e.images %}
      <div class="blog-index-imgs">
        {% for src in e.images %}<img src="{{src}}" alt="{{e.images_alt[loop.index-1]}}"/>{% endfor %}
      </div>
    {% endif %}
    <p>{{e.excerpt}}</p>
    <p class="blog-index-read-more"><a href="{{e.url}}">read more</a></p>
  </article>
{% endfor %}
"""


# ---

# Widgets
[widgets]

# Page title
[widgets.page-title]
widget = "title"
selector = "h1"
default = "conflores"
append = " &mdash; conflores"

# Header and footer
[widgets.insert-header]
widget = "include"
file = "templates/header.html"
selector = "body"
action = "prepend_child"
[widgets.insert-footer]
widget = "include"
file = "templates/footer.html"
selector = "body"
action = "append_child"

# Post header
[widgets.append-date]
widget = "append-date"
selector = "h1"

# Move style to the head
[widgets.inline-style]
widget = "inline-style"

# Highlight code
[widgets.highlight]
widget = "preprocess_element"
selector = '*[class^="language-"]'
command = 'highlight -O html -f --syntax=$(echo $ATTR_CLASS | sed -e "s/language-//")'
action = "replace_content"

# RSS Feed
[widgets.atom]
page = "index.html"
widget = "atom"
feed_file = "atom.xml"
use_section = "blog"

[widgets.atom-web-platform]
page = "index.html"
widget = "atom"
feed_file = "web-platform.xml"
use_section = "blog"
use_tag = "web-platform"

# Table of contents
[widgets.table-of-contents]
widget = "toc"
selector = ".post-date"
action = "insert_after"
exclude_page = "index.html"
min_level = 2
toc_list_class = "toc"
heading_links = true
heading_link_text = "→ "
use_heading_slug = true
